import pickle
import numpy as np
import sklearn.manifold
import pandas as pd
import matplotlib.pyplot as plt
with open('gdrive/My Drive/NI Project - RSA/confusion_dict_fashionmnist_final2.pkl', 'rb') as fp:
    confusion_dic = pickle.load(fp)


for i in range(len(confusion_dic)):
    confusion_dic[i] = confusion_dic[i].flatten()
confusion_dic_array = np.array(list(confusion_dic.values()))
print(confusion_dic_array.shape)


# all accuracies
with open('gdrive/My Drive/NI Project - RSA/acc_mlp_fashionmnist_rsa_final_2.pkl', 'rb') as fp:
  acc_list_mlp = pickle.load(fp)

with open('gdrive/My Drive/NI Project - RSA/acc_conv_fashionmnist_rsa_final.pkl', 'rb') as fp:
  acc_list_convnet = pickle.load(fp)


acc_df_mlp = pd.DataFrame(acc_list_mlp, columns = ['acc', 'loc'])
acc_df_mlp['model_type'] = np.zeros(len(acc_df_mlp))
acc_df_convnet = pd.DataFrame(acc_list_convnet, columns = ['acc', 'loc'])
acc_df_convnet['model_type'] = np.ones(len(acc_df_convnet))
acc_df = pd.concat([acc_df_mlp,acc_df_convnet], axis=0, ignore_index = True) #acc_df_convnet #p
acc_df['index'] = acc_df.index
acc_df = acc_df.sort_values(by = 'acc', ascending = True)
acc_sorted = acc_df['acc']

conv_index = acc_df['model_type']==1

acc_high = acc_df['acc'] > 0.8

# MDS embedding
embedding = sklearn.manifold.MDS(n_components=2, metric=True)
embed_confusion = embedding.fit_transform(confusion_dic_array[acc_high, :])

fig, ax = plt.subplots(figsize=(10, 8))
points = ax.scatter(embed_confusion[:, 0], embed_confusion[:, 1], c=acc_sorted[acc_high], cmap='rainbow')
ax.set_xlabel(r'$x_1$')
ax.set_ylabel(r'$x_2$')
ax.set_title(r'Multiple Dimensional Scaling for Rank Correlations between Models($Acc \geq 70%$)')
plt.colorbar(points, ax=ax)
